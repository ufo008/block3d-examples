console.log("Block3D-一款支持可视化编程的Web3D开发工具www.zjbku.com");const appInstance=BABYLON.apps[0];function tab_init(e){var n,o,t,s;(e=e.getControlByName("blocker")).isPointerBlocker=!0,e.onPointerEnterObservable.add(()=>{appInstance.scene.getNodeByName("defaultCamera").detachControl()}),e.onPointerOutObservable.add(()=>{appInstance.scene.getNodeByName("defaultCamera").attachControl()}),(e=new BABYLON.DirectionalLight("directionallight",new BABYLON.Vector3(-.469,-.503,.726),appInstance.scene)).intensity=1,e.position=new BABYLON.Vector3(0,6,-4),appInstance.env&&appInstance.env.dispose(),appInstance.env=appInstance.scene.createDefaultEnvironment({enableGroundShadow:!0,environmentTexture:"assets/texture/environmentSpecular.env",skyboxTexture:"assets/texture/backgroundSkybox.dds",groundTexture:"assets/texture/backgroundGround.png",skyboxSize:40,skyboxColor:new BABYLON.Color3(.3,.2,.5),groundColor:new BABYLON.Color3(.3,.2,.4)}),appInstance.scene.getNodeByName("defaultCamera").setTarget(new BABYLON.Vector3(0,2,0)),appInstance.scene.getNodeByName("defaultCamera").alpha=BABYLON.Tools.ToRadians(270),appInstance.scene.getNodeByName("defaultCamera").lowerAlphaLimit=BABYLON.Tools.ToRadians(225),appInstance.scene.getNodeByName("defaultCamera").upperAlphaLimit=BABYLON.Tools.ToRadians(315),appInstance.scene.getNodeByName("defaultCamera").beta=BABYLON.Tools.ToRadians(90),appInstance.scene.getNodeByName("defaultCamera").lowerBetaLimit=BABYLON.Tools.ToRadians(45),appInstance.scene.getNodeByName("defaultCamera").upperBetaLimit=BABYLON.Tools.ToRadians(135),appInstance.scene.getNodeByName("defaultCamera").lockedTarget=new BABYLON.Vector3(0,2,0);{var a=.45,r=2,i=15;const c=appInstance.scene.activeCamera;if("ArcRotateCamera"!==c.getClassName())throw new Error("The effect only supports ArcRotateCamera");c.lowerRadiusLimit=r,c.upperRadiusLimit=i;const p=new BABYLON.BouncingBehavior;p.transitionDuration=1e3*a,p.autoTransitionRange=!0,p.attach(c)}r=appInstance.scene.getNodeByName("blank"),i=appInstance.scene.getNodeByName("blocks").getChildMeshes(),r.visibility=0,(n=new BABYLON.ShadowGenerator(1024,e)).useBlurExponentialShadowMap=!0,n.blurKernel=8,o={},i.forEach((e,a)=>{e.receiveShadows=!1,n.addShadowCaster(e),e.isPickable=!0,t=e.name,s=e.position,o[t]=s}),appInstance.glob.originPosition={blank:r.position,blocks:o}}function tab_moveBlock(e){var a;function n(e,a,n){if(appInstance._glob.pickedMesh)switch(e){case"MESH":return appInstance._glob.pickedMesh;case"POINT":switch(a){case"X":return appInstance._glob.pickedPoint.x;case"Y":return appInstance._glob.pickedPoint.y;case"Z":return appInstance._glob.pickedPoint.z;case"XYZ":return appInstance._glob.pickedPoint}break;case"NORMAL":switch(n){case"X":return appInstance._glob.pickedNormal.x;case"Y":return appInstance._glob.pickedNormal.y;case"Z":return appInstance._glob.pickedNormal.z;case"XYZ":return appInstance._glob.pickedNormal}}}function o(a,e,n,o,t,s,r,i){const c=BABYLON.Animation.CreateAnimation(e,o,s,r);BABYLON.Animation.TransitionTo(e,n,a,appInstance.scene,s,c,1e3*t,()=>{var e=a.animations.indexOf(c);-1!==e&&a.animations.splice(e,1),i()})}appInstance.scene.getNodeByName("blocks").getChildMeshes();{var t=BABYLON.PointerEventTypes.POINTERPICK,s=!1,r=()=>{n("MESH","null","null").isDescendantOf(appInstance.scene.getNodeByName("blocks"))&&(BABYLON.Vector3.Distance(appInstance.scene.getNodeByName("blank").position,n("MESH","null","null").position)<1.1?(a=appInstance.scene.getNodeByName("blank").position,appInstance.scene.getNodeByName("blank").position=n("MESH","null","null").position,o(n("MESH","null","null"),"position",a,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,.2,60,new BABYLON.PowerEase(2),()=>{})):o(n("MESH","null","null"),"scaling",new BABYLON.Vector3(1.1,1.1,1.1),BABYLON.Animation.ANIMATIONTYPE_VECTOR3,.2,60,new BABYLON.BounceEase(2,.1),()=>{n("MESH","null","null").scaling=new BABYLON.Vector3(1,1,1)}))};const c=appInstance["scene"],p=c.activeCamera;function i(e,a,n,o){e=e.subtract(a),n=n.subtract(a),a=BABYLON.Vector3.Cross(e,n);return BABYLON.Vector3.Dot(o.direction,a)<0}return void c.onPointerObservable.add(()=>{const e=c.pick(c.pointerX,c.pointerY,void 0,!1,p,s?i:void 0);e&&e.hit&&(appInstance._glob.pickedMesh=e.pickedMesh,appInstance._glob.pickedPoint=e.pickedPoint,appInstance._glob.pickedNormal=e.getNormal(),r())},t)}}function tab_randomBlock(e){var a,n,o,t,s,r;function i(){a.forEach((e,a)=>{e.isMoving=!1})}function c(e,a){var n=Math.floor(Math.random()*e.length);return a?e.splice(n,1)[0]:e[n]}function p(a,e,n,o,t,s,r,i){const c=BABYLON.Animation.CreateAnimation(e,o,s,r);BABYLON.Animation.TransitionTo(e,n,a,appInstance.scene,s,c,1e3*t,()=>{var e=a.animations.indexOf(c);-1!==e&&a.animations.splice(e,1),i()})}n=e.getControlByName("Random"),a=appInstance.scene.getNodeByName("blocks").getChildMeshes(),i(),n.onPointerClickObservable.add(()=>{n.isEnabled=!1;for(var e=0;e<15;e++)o=c(a,!1),t=c(a,!1),o==t||o.isMoving||t.isMoving||(o.isMoving=!0,t.isMoving=!0,s=o.position,r=t.position,p(o,"position",r,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,.2,60,new BABYLON.PowerEase(2),()=>{}),p(t,"position",s,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,.2,60,new BABYLON.PowerEase(2),()=>{n.isEnabled=!0,i()}))})}function tab_resetBlock(e){var n;e.getControlByName("Reset").onPointerClickObservable.add(()=>{appInstance.scene.getNodeByName("blocks").getChildMeshes().forEach((e,a)=>{n=e.name,e.position=appInstance.glob.originPosition.blocks[n]}),appInstance.scene.getNodeByName("blank").position=appInstance.glob.originPosition.blank})}(()=>{var e,a,n,o,t;{var s={background:"radial-gradient(#705d8d, #4d3472)",logoImage:"../media/logo.svg",barBackground:"linear-gradient(90deg, #ff5f5f, #ed9191)",barBorder:"1px solid #ff5f5f"};function r(e){for(var a=document.styleSheets,n=0;n<a.length;n++){try{var o=a[n].cssRules}catch(e){continue}for(var t=0;t<o.length;t++){var s=o[t];if(s.selectorText==e)return s.style}}}const i=r(".preloader-background"),c=r(".preloader-logo"),p=r(".preloader-bar"),l=r(".preloader-bar");s.hasOwnProperty("background")&&(i.background=s.background),s.hasOwnProperty("logoImage")&&(c.background="center / contain no-repeat url("+s.logoImage+")"),s.hasOwnProperty("barBackground")&&(p.background=s.barBackground),s.hasOwnProperty("barBorder")&&(l.border=s.barBorder),s.hasOwnProperty("barHeight")&&(l.height=s.barHeight),appInstance.preloader=new BABYLON.Preloader(appInstance.canvas),appInstance.preloader.start()}s=!1,n=()=>{appInstance.assetsManager.addMeshTask("loadAsset","","./assets/scene/","puzzleGame.babylon"),a=appInstance.assetsManager.addBinaryFileTask("loadGUI","assets/json/gui.json")},o=()=>{appInstance.preloader&&appInstance.preloader.update(appInstance._glob.preloaderPercentage)},t=()=>{tab_init(e=function(e,a){appInstance.overlaySceneEnabled=!0;let n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(e,!0,appInstance.overlayScene,BABYLON.Texture.NEAREST_NEAREST);return n.parseContent(JSON.parse(a)),n.rootContainer.scaleX=window.devicePixelRatio,n.rootContainer.scaleY=window.devicePixelRatio,n.rootContainer.isPointerBlocker=!0,n}("gui",String.fromCharCode.apply(null,new Uint8Array(a.data)))),appInstance.preloader&&appInstance.preloader.finish(),tab_moveBlock(e),tab_randomBlock(e),tab_resetBlock(e)},appInstance.assetsManager=new BABYLON.AssetsManager(appInstance.scene),appInstance.assetsManager.useDefaultLoadingScreen=!!s,n(),appInstance.assetsManager.load(),appInstance.assetsManager.onProgress=(e,a)=>{e=((a-e)/a*100).toFixed();appInstance._glob.preloaderPercentage=e,o()},appInstance.assetsManager.onFinish=e=>{t()},appInstance.assetsManager.onTaskError=e=>{console.error(new Error(e.errorObject.message))}})();